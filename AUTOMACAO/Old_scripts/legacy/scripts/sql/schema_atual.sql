-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.ai_automation_executions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  automation_id uuid,
  trigger_data jsonb DEFAULT '{}'::jsonb,
  ai_request text,
  ai_response text,
  action_result jsonb DEFAULT '{}'::jsonb,
  status character varying CHECK (status::text = ANY (ARRAY['success'::character varying, 'failed'::character varying, 'partial'::character varying]::text[])),
  execution_time_ms integer,
  error_message text,
  tokens_used integer,
  cost numeric DEFAULT 0.0000,
  executed_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_automation_executions_pkey PRIMARY KEY (id),
  CONSTRAINT ai_automation_executions_automation_id_fkey FOREIGN KEY (automation_id) REFERENCES public.ai_automations(id)
);
CREATE TABLE public.ai_automations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  trigger_type character varying CHECK (trigger_type::text = ANY (ARRAY['webhook'::character varying, 'schedule'::character varying, 'email'::character varying, 'form_submit'::character varying, 'api_call'::character varying]::text[])),
  trigger_config jsonb DEFAULT '{}'::jsonb,
  ai_model character varying,
  ai_prompt text,
  ai_config jsonb DEFAULT '{}'::jsonb,
  action_type character varying CHECK (action_type::text = ANY (ARRAY['send_email'::character varying, 'create_task'::character varying, 'update_crm'::character varying, 'post_social'::character varying, 'generate_content'::character varying]::text[])),
  action_config jsonb DEFAULT '{}'::jsonb,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'paused'::character varying, 'inactive'::character varying]::text[])),
  execution_count integer DEFAULT 0,
  success_count integer DEFAULT 0,
  error_count integer DEFAULT 0,
  last_executed timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_automations_pkey PRIMARY KEY (id),
  CONSTRAINT ai_automations_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT ai_automations_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.ai_conversation_messages (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  conversation_id uuid,
  role character varying CHECK (role::text = ANY (ARRAY['user'::character varying, 'assistant'::character varying, 'system'::character varying]::text[])),
  content text NOT NULL,
  tokens integer,
  model character varying,
  temperature numeric,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_conversation_messages_pkey PRIMARY KEY (id),
  CONSTRAINT ai_conversation_messages_conversation_id_fkey FOREIGN KEY (conversation_id) REFERENCES public.ai_conversations(id)
);
CREATE TABLE public.ai_conversations (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  user_id uuid,
  title character varying,
  context character varying,
  model character varying,
  system_prompt text,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'archived'::character varying, 'deleted'::character varying]::text[])),
  total_messages integer DEFAULT 0,
  total_tokens integer DEFAULT 0,
  cost numeric DEFAULT 0.0000,
  tags jsonb DEFAULT '[]'::jsonb,
  metadata jsonb DEFAULT '{}'::jsonb,
  started_at timestamp with time zone DEFAULT now(),
  last_activity timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_conversations_pkey PRIMARY KEY (id),
  CONSTRAINT ai_conversations_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT ai_conversations_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.analytics_dashboards (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  layout jsonb DEFAULT '[]'::jsonb,
  widgets jsonb DEFAULT '[]'::jsonb,
  filters jsonb DEFAULT '[]'::jsonb,
  permissions jsonb DEFAULT '[]'::jsonb,
  is_public boolean DEFAULT false,
  is_default boolean DEFAULT false,
  refresh_interval integer DEFAULT 300,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT analytics_dashboards_pkey PRIMARY KEY (id),
  CONSTRAINT analytics_dashboards_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT analytics_dashboards_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.analytics_metrics (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  metric_name character varying NOT NULL,
  category character varying,
  subcategory character varying,
  value numeric NOT NULL,
  unit character varying,
  date date NOT NULL,
  period character varying,
  source_system character varying,
  dimensions jsonb DEFAULT '{}'::jsonb,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT analytics_metrics_pkey PRIMARY KEY (id),
  CONSTRAINT analytics_metrics_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.analytics_reports (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  type character varying CHECK (type::text = ANY (ARRAY['sales'::character varying, 'marketing'::character varying, 'financial'::character varying, 'operational'::character varying, 'custom'::character varying]::text[])),
  category character varying,
  frequency character varying CHECK (frequency::text = ANY (ARRAY['daily'::character varying, 'weekly'::character varying, 'monthly'::character varying, 'quarterly'::character varying, 'yearly'::character varying, 'on_demand'::character varying]::text[])),
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'draft'::character varying]::text[])),
  parameters jsonb DEFAULT '{}'::jsonb,
  filters jsonb DEFAULT '{}'::jsonb,
  chart_config jsonb DEFAULT '{}'::jsonb,
  recipients jsonb DEFAULT '[]'::jsonb,
  last_generated timestamp with time zone,
  next_generation timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT analytics_reports_pkey PRIMARY KEY (id),
  CONSTRAINT analytics_reports_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT analytics_reports_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.audit_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  action_type character varying NOT NULL,
  entity_type character varying NOT NULL,
  entity_id uuid,
  entity_name character varying,
  actor_type character varying NOT NULL,
  actor_id uuid,
  actor_name character varying,
  actor_ip_address inet,
  user_agent text,
  action_description text NOT NULL,
  before_state jsonb,
  after_state jsonb,
  changes_summary jsonb,
  session_id character varying,
  request_id character varying,
  business_context character varying,
  automated boolean DEFAULT false,
  risk_level character varying DEFAULT 'low'::character varying CHECK (risk_level::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying]::text[])),
  sensitive_data_involved boolean DEFAULT false,
  compliance_relevant boolean DEFAULT false,
  success boolean NOT NULL DEFAULT true,
  error_message text,
  rollback_possible boolean DEFAULT true,
  rollback_data jsonb,
  executed_at timestamp with time zone DEFAULT now(),
  duration_ms integer,
  search_text text DEFAULT (((((COALESCE(entity_name, ''::character varying))::text || ' '::text) || (COALESCE(actor_name, ''::character varying))::text) || ' '::text) || COALESCE(action_description, ''::text)),
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT audit_logs_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.audit_reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  report_type character varying NOT NULL,
  report_category character varying NOT NULL,
  report_format character varying NOT NULL,
  report_period_start timestamp with time zone NOT NULL,
  report_period_end timestamp with time zone NOT NULL,
  data_cutoff_time timestamp with time zone DEFAULT now(),
  generated_by_user_id uuid,
  generated_by_system character varying,
  generation_trigger character varying,
  summary jsonb NOT NULL,
  total_events integer DEFAULT 0,
  critical_events integer DEFAULT 0,
  warnings_count integer DEFAULT 0,
  errors_count integer DEFAULT 0,
  filters_applied jsonb,
  included_event_types ARRAY,
  excluded_event_types ARRAY,
  generation_status character varying DEFAULT 'completed'::character varying CHECK (generation_status::text = ANY (ARRAY['pending'::character varying, 'generating'::character varying, 'completed'::character varying, 'failed'::character varying]::text[])),
  file_size_bytes bigint,
  file_location text,
  download_count integer DEFAULT 0,
  recipients jsonb,
  email_sent boolean DEFAULT false,
  email_sent_at timestamp with time zone,
  retention_policy character varying DEFAULT 'standard'::character varying,
  compliance_export boolean DEFAULT false,
  delete_after_days integer DEFAULT 90,
  generated_at timestamp with time zone DEFAULT now(),
  expires_at timestamp with time zone,
  last_accessed_at timestamp with time zone,
  CONSTRAINT audit_reports_pkey PRIMARY KEY (id),
  CONSTRAINT audit_reports_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT audit_reports_generated_by_user_id_fkey FOREIGN KEY (generated_by_user_id) REFERENCES public.personas(id)
);
CREATE TABLE public.auditorias (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  auditoria_tipo text NOT NULL,
  titulo text NOT NULL,
  resultados jsonb DEFAULT '{}'::jsonb,
  recomendacoes ARRAY,
  score numeric,
  status text DEFAULT 'concluida'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT auditorias_pkey PRIMARY KEY (id),
  CONSTRAINT auditorias_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.auditorias_compatibilidade (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid NOT NULL,
  persona_id uuid NOT NULL,
  workflow_reference character varying NOT NULL,
  meta_global_id uuid,
  meta_persona_id uuid,
  compatibilidade_score integer NOT NULL CHECK (compatibilidade_score >= 0 AND compatibilidade_score <= 100),
  compatibilidade_nivel character varying NOT NULL DEFAULT 'medio'::character varying CHECK (compatibilidade_nivel::text = ANY (ARRAY['baixo'::character varying, 'medio'::character varying, 'alto'::character varying, 'excelente'::character varying]::text[])),
  analise_detalhada jsonb DEFAULT '{}'::jsonb,
  observacoes text,
  acoes_sugeridas ARRAY,
  status_auditoria character varying NOT NULL DEFAULT 'pendente'::character varying CHECK (status_auditoria::text = ANY (ARRAY['pendente'::character varying, 'em_analise'::character varying, 'aprovado'::character varying, 'reprovado'::character varying, 'requer_ajuste'::character varying]::text[])),
  auditado_por character varying,
  auditado_em timestamp with time zone,
  proxima_auditoria date,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT auditorias_compatibilidade_pkey PRIMARY KEY (id),
  CONSTRAINT auditorias_compatibilidade_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT auditorias_compatibilidade_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id),
  CONSTRAINT auditorias_compatibilidade_meta_global_id_fkey FOREIGN KEY (meta_global_id) REFERENCES public.metas_globais(id),
  CONSTRAINT auditorias_compatibilidade_meta_persona_id_fkey FOREIGN KEY (meta_persona_id) REFERENCES public.metas_personas(id)
);
CREATE TABLE public.avatares_personas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_id uuid NOT NULL,
  avatar_url character varying NOT NULL,
  avatar_thumbnail_url character varying,
  prompt_usado text NOT NULL,
  estilo character varying NOT NULL DEFAULT 'corporate'::character varying CHECK (estilo::text = ANY (ARRAY['corporate'::character varying, 'casual'::character varying, 'creative'::character varying, 'formal'::character varying]::text[])),
  background_tipo character varying NOT NULL DEFAULT 'office'::character varying CHECK (background_tipo::text = ANY (ARRAY['office'::character varying, 'home_office'::character varying, 'neutral'::character varying, 'custom'::character varying]::text[])),
  servico_usado character varying NOT NULL DEFAULT 'nano_banana'::character varying CHECK (servico_usado::text = ANY (ARRAY['nano_banana'::character varying, 'dall_e'::character varying, 'midjourney'::character varying, 'custom'::character varying]::text[])),
  versao integer NOT NULL DEFAULT 1,
  ativo boolean NOT NULL DEFAULT true,
  metadados jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT avatares_personas_pkey PRIMARY KEY (id),
  CONSTRAINT avatares_personas_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.bi_dashboards (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  category character varying,
  layout jsonb DEFAULT '{}'::jsonb,
  widgets jsonb DEFAULT '[]'::jsonb,
  data_sources jsonb DEFAULT '[]'::jsonb,
  filters jsonb DEFAULT '[]'::jsonb,
  refresh_schedule character varying,
  auto_refresh boolean DEFAULT false,
  is_public boolean DEFAULT false,
  access_permissions jsonb DEFAULT '[]'::jsonb,
  last_refreshed timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bi_dashboards_pkey PRIMARY KEY (id),
  CONSTRAINT bi_dashboards_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id),
  CONSTRAINT bi_dashboards_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.bi_data_models (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  name character varying NOT NULL,
  description text,
  type character varying CHECK (type::text = ANY (ARRAY['table'::character varying, 'view'::character varying, 'calculated'::character varying, 'aggregate'::character varying]::text[])),
  source_tables jsonb DEFAULT '[]'::jsonb,
  sql_query text,
  columns jsonb DEFAULT '[]'::jsonb,
  relationships jsonb DEFAULT '[]'::jsonb,
  calculated_fields jsonb DEFAULT '[]'::jsonb,
  refresh_schedule character varying,
  last_refreshed timestamp with time zone,
  row_count integer,
  data_size_mb numeric,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'building'::character varying, 'error'::character varying, 'inactive'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bi_data_models_pkey PRIMARY KEY (id),
  CONSTRAINT bi_data_models_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.bi_reports (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  type character varying CHECK (type::text = ANY (ARRAY['tabular'::character varying, 'chart'::character varying, 'pivot'::character varying, 'crosstab'::character varying, 'dashboard'::character varying]::text[])),
  data_model_id uuid,
  query_config jsonb DEFAULT '{}'::jsonb,
  visualization_config jsonb DEFAULT '{}'::jsonb,
  parameters jsonb DEFAULT '[]'::jsonb,
  schedule character varying,
  recipients jsonb DEFAULT '[]'::jsonb,
  format character varying DEFAULT 'pdf'::character varying CHECK (format::text = ANY (ARRAY['pdf'::character varying, 'excel'::character varying, 'csv'::character varying, 'html'::character varying]::text[])),
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'draft'::character varying]::text[])),
  last_generated timestamp with time zone,
  next_generation timestamp with time zone,
  generation_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bi_reports_pkey PRIMARY KEY (id),
  CONSTRAINT bi_reports_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT bi_reports_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id),
  CONSTRAINT bi_reports_data_model_id_fkey FOREIGN KEY (data_model_id) REFERENCES public.bi_data_models(id)
);
CREATE TABLE public.competencias (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_id uuid NOT NULL,
  tipo character varying NOT NULL CHECK (tipo::text = ANY (ARRAY['principal'::character varying, 'tecnica'::character varying, 'soft_skill'::character varying]::text[])),
  nome character varying NOT NULL,
  descricao text,
  nivel character varying DEFAULT 'avancado'::character varying CHECK (nivel::text = ANY (ARRAY['basico'::character varying, 'intermediario'::character varying, 'avancado'::character varying, 'expert'::character varying]::text[])),
  categoria character varying,
  created_at timestamp with time zone DEFAULT now(),
  atribuicoes_detalhadas text CHECK (char_length(atribuicoes_detalhadas) <= 1000),
  escopo_sdr_hibrido boolean DEFAULT false,
  CONSTRAINT competencias_pkey PRIMARY KEY (id),
  CONSTRAINT competencias_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.compliance_audit (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  compliance_framework character varying NOT NULL,
  compliance_requirement character varying NOT NULL,
  control_id character varying,
  assessment_type character varying NOT NULL,
  assessment_status character varying NOT NULL,
  compliance_score integer CHECK (compliance_score >= 0 AND compliance_score <= 100),
  evidence_type character varying,
  evidence_description text,
  evidence_data jsonb,
  evidence_file_reference character varying,
  findings ARRAY,
  gaps_identified ARRAY,
  recommendations ARRAY,
  risk_level character varying DEFAULT 'low'::character varying CHECK (risk_level::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying]::text[])),
  corrective_actions jsonb,
  action_owner_user_id uuid,
  action_due_date date,
  action_status character varying DEFAULT 'pending'::character varying CHECK (action_status::text = ANY (ARRAY['pending'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'overdue'::character varying]::text[])),
  action_completed_at timestamp with time zone,
  auditor_name character varying,
  auditor_type character varying NOT NULL,
  audit_period_start date NOT NULL,
  audit_period_end date NOT NULL,
  assessed_at timestamp with time zone DEFAULT now(),
  next_assessment_due timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT compliance_audit_pkey PRIMARY KEY (id),
  CONSTRAINT compliance_audit_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT compliance_audit_action_owner_user_id_fkey FOREIGN KEY (action_owner_user_id) REFERENCES public.personas(id)
);
CREATE TABLE public.configuration_audit (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  config_type character varying NOT NULL,
  config_category character varying NOT NULL,
  config_section character varying,
  config_key character varying NOT NULL,
  change_type character varying NOT NULL,
  old_value jsonb,
  new_value jsonb,
  default_value jsonb,
  changed_by_user_id uuid,
  changed_by_username character varying,
  change_reason text,
  approval_required boolean DEFAULT false,
  approved_by_user_id uuid,
  approved_at timestamp with time zone,
  impact_assessment text,
  validation_status character varying DEFAULT 'pending'::character varying CHECK (validation_status::text = ANY (ARRAY['pending'::character varying, 'validated'::character varying, 'failed'::character varying, 'rolled_back'::character varying]::text[])),
  validation_errors ARRAY,
  compliance_impact boolean DEFAULT false,
  security_impact boolean DEFAULT false,
  requires_restart boolean DEFAULT false,
  rollback_available boolean DEFAULT true,
  rolled_back_at timestamp with time zone,
  rollback_reason text,
  changed_at timestamp with time zone DEFAULT now(),
  effective_at timestamp with time zone DEFAULT now(),
  expires_at timestamp with time zone,
  CONSTRAINT configuration_audit_pkey PRIMARY KEY (id),
  CONSTRAINT configuration_audit_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT configuration_audit_changed_by_user_id_fkey FOREIGN KEY (changed_by_user_id) REFERENCES public.personas(id),
  CONSTRAINT configuration_audit_approved_by_user_id_fkey FOREIGN KEY (approved_by_user_id) REFERENCES public.personas(id)
);
CREATE TABLE public.content_assets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  empresa_id uuid,
  name character varying NOT NULL,
  type character varying CHECK (type::text = ANY (ARRAY['video'::character varying, 'audio'::character varying, 'image'::character varying, 'document'::character varying, 'script'::character varying, 'outline'::character varying, 'thumbnail'::character varying]::text[])),
  file_url character varying,
  file_size integer,
  file_format character varying,
  duration_seconds integer,
  resolution character varying,
  quality character varying,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'review'::character varying, 'approved'::character varying, 'published'::character varying, 'archived'::character varying]::text[])),
  version integer DEFAULT 1,
  created_by uuid,
  approved_by uuid,
  approved_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  tags jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT content_assets_pkey PRIMARY KEY (id),
  CONSTRAINT content_assets_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.content_projects(id),
  CONSTRAINT content_assets_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT content_assets_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.personas(id),
  CONSTRAINT content_assets_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.personas(id)
);
CREATE TABLE public.content_projects (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  type character varying CHECK (type::text = ANY (ARRAY['video'::character varying, 'blog_post'::character varying, 'podcast'::character varying, 'ebook'::character varying, 'whitepaper'::character varying, 'infographic'::character varying, 'webinar'::character varying, 'course'::character varying]::text[])),
  status character varying DEFAULT 'planning'::character varying CHECK (status::text = ANY (ARRAY['planning'::character varying, 'scripting'::character varying, 'production'::character varying, 'editing'::character varying, 'review'::character varying, 'approved'::character varying, 'published'::character varying, 'cancelled'::character varying]::text[])),
  priority character varying DEFAULT 'medium'::character varying CHECK (priority::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'urgent'::character varying]::text[])),
  target_audience character varying,
  keywords jsonb DEFAULT '[]'::jsonb,
  objectives jsonb DEFAULT '[]'::jsonb,
  budget numeric,
  deadline date,
  publish_date date,
  platforms jsonb DEFAULT '[]'::jsonb,
  collaboration_notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT content_projects_pkey PRIMARY KEY (id),
  CONSTRAINT content_projects_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT content_projects_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.content_scripts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  name character varying NOT NULL,
  type character varying CHECK (type::text = ANY (ARRAY['video_script'::character varying, 'podcast_script'::character varying, 'presentation'::character varying, 'outline'::character varying, 'storyboard'::character varying]::text[])),
  content text NOT NULL,
  estimated_duration_minutes integer,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'review'::character varying, 'approved'::character varying, 'final'::character varying]::text[])),
  version integer DEFAULT 1,
  notes text,
  created_by uuid,
  reviewed_by uuid,
  approved_by uuid,
  approved_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT content_scripts_pkey PRIMARY KEY (id),
  CONSTRAINT content_scripts_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.content_projects(id),
  CONSTRAINT content_scripts_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.personas(id),
  CONSTRAINT content_scripts_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.personas(id),
  CONSTRAINT content_scripts_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.personas(id)
);
CREATE TABLE public.crm_activities (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  lead_id uuid,
  opportunity_id uuid,
  persona_id uuid,
  type character varying CHECK (type::text = ANY (ARRAY['call'::character varying, 'email'::character varying, 'meeting'::character varying, 'task'::character varying, 'note'::character varying, 'demo'::character varying]::text[])),
  subject character varying NOT NULL,
  description text,
  status character varying DEFAULT 'planned'::character varying CHECK (status::text = ANY (ARRAY['planned'::character varying, 'completed'::character varying, 'cancelled'::character varying]::text[])),
  priority character varying DEFAULT 'medium'::character varying CHECK (priority::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'urgent'::character varying]::text[])),
  due_date timestamp with time zone,
  completed_at timestamp with time zone,
  duration_minutes integer,
  outcome character varying,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT crm_activities_pkey PRIMARY KEY (id),
  CONSTRAINT crm_activities_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT crm_activities_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.crm_leads(id),
  CONSTRAINT crm_activities_opportunity_id_fkey FOREIGN KEY (opportunity_id) REFERENCES public.crm_opportunities(id),
  CONSTRAINT crm_activities_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.crm_leads (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  owner_persona_id uuid,
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  full_name character varying NOT NULL,
  email character varying,
  phone character varying,
  company character varying,
  position character varying,
  industry character varying,
  website character varying,
  linkedin_url character varying,
  source character varying,
  status character varying DEFAULT 'new'::character varying CHECK (status::text = ANY (ARRAY['new'::character varying, 'contacted'::character varying, 'qualified'::character varying, 'proposal'::character varying, 'negotiation'::character varying, 'closed_won'::character varying, 'closed_lost'::character varying, 'nurturing'::character varying]::text[])),
  lead_score integer DEFAULT 0,
  estimated_value numeric,
  probability numeric DEFAULT 0.00,
  expected_close_date date,
  stage character varying,
  tags jsonb DEFAULT '[]'::jsonb,
  notes text,
  custom_fields jsonb DEFAULT '{}'::jsonb,
  last_contact_date timestamp with time zone,
  next_follow_up timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT crm_leads_pkey PRIMARY KEY (id),
  CONSTRAINT crm_leads_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT crm_leads_owner_persona_id_fkey FOREIGN KEY (owner_persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.crm_opportunities (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  lead_id uuid,
  pipeline_id uuid,
  stage_id uuid,
  owner_persona_id uuid,
  name character varying NOT NULL,
  description text,
  value numeric DEFAULT 0.00,
  probability numeric DEFAULT 0.00,
  expected_close_date date,
  actual_close_date date,
  source character varying,
  status character varying DEFAULT 'open'::character varying CHECK (status::text = ANY (ARRAY['open'::character varying, 'won'::character varying, 'lost'::character varying, 'abandoned'::character varying]::text[])),
  tags jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT crm_opportunities_pkey PRIMARY KEY (id),
  CONSTRAINT crm_opportunities_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT crm_opportunities_lead_id_fkey FOREIGN KEY (lead_id) REFERENCES public.crm_leads(id),
  CONSTRAINT crm_opportunities_pipeline_id_fkey FOREIGN KEY (pipeline_id) REFERENCES public.crm_pipelines(id),
  CONSTRAINT crm_opportunities_stage_id_fkey FOREIGN KEY (stage_id) REFERENCES public.crm_pipeline_stages(id),
  CONSTRAINT crm_opportunities_owner_persona_id_fkey FOREIGN KEY (owner_persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.crm_pipeline_stages (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pipeline_id uuid,
  name character varying NOT NULL,
  description text,
  sort_order integer NOT NULL,
  probability numeric DEFAULT 0.00,
  is_closed boolean DEFAULT false,
  stage_type character varying CHECK (stage_type::text = ANY (ARRAY['open'::character varying, 'won'::character varying, 'lost'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT crm_pipeline_stages_pkey PRIMARY KEY (id),
  CONSTRAINT crm_pipeline_stages_pipeline_id_fkey FOREIGN KEY (pipeline_id) REFERENCES public.crm_pipelines(id)
);
CREATE TABLE public.crm_pipelines (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  name character varying NOT NULL,
  description text,
  is_default boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT crm_pipelines_pkey PRIMARY KEY (id),
  CONSTRAINT crm_pipelines_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.data_audit_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  data_operation character varying NOT NULL,
  data_type character varying NOT NULL,
  data_classification character varying NOT NULL,
  table_name character varying,
  record_count integer DEFAULT 1,
  record_ids jsonb,
  columns_accessed ARRAY,
  accessed_by_user_id uuid,
  accessed_by_username character varying,
  access_purpose text NOT NULL,
  legal_basis character varying,
  access_method character varying,
  source_ip inet,
  client_application character varying,
  filter_criteria jsonb,
  date_range_start date,
  date_range_end date,
  operation_successful boolean NOT NULL DEFAULT true,
  error_details text,
  data_exported boolean DEFAULT false,
  export_format character varying,
  export_filename character varying,
  consent_verified boolean DEFAULT false,
  retention_policy_applied boolean DEFAULT true,
  anonymized boolean DEFAULT false,
  accessed_at timestamp with time zone DEFAULT now(),
  data_retention_until timestamp with time zone,
  CONSTRAINT data_audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT data_audit_logs_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT data_audit_logs_accessed_by_user_id_fkey FOREIGN KEY (accessed_by_user_id) REFERENCES public.personas(id)
);
CREATE TABLE public.ecommerce_order_items (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  order_id uuid,
  product_id uuid,
  variant_id uuid,
  sku character varying NOT NULL,
  product_name character varying NOT NULL,
  variant_name character varying,
  quantity integer NOT NULL DEFAULT 1,
  price numeric NOT NULL,
  total_price numeric NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ecommerce_order_items_pkey PRIMARY KEY (id),
  CONSTRAINT ecommerce_order_items_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.ecommerce_orders(id),
  CONSTRAINT ecommerce_order_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.ecommerce_products(id),
  CONSTRAINT ecommerce_order_items_variant_id_fkey FOREIGN KEY (variant_id) REFERENCES public.ecommerce_product_variants(id)
);
CREATE TABLE public.ecommerce_orders (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  order_number character varying NOT NULL UNIQUE,
  customer_id uuid,
  customer_email character varying NOT NULL,
  customer_name character varying NOT NULL,
  customer_phone character varying,
  billing_address jsonb DEFAULT '{}'::jsonb,
  shipping_address jsonb DEFAULT '{}'::jsonb,
  subtotal numeric NOT NULL DEFAULT 0.00,
  shipping_cost numeric DEFAULT 0.00,
  tax_amount numeric DEFAULT 0.00,
  discount_amount numeric DEFAULT 0.00,
  total_amount numeric NOT NULL DEFAULT 0.00,
  currency character varying DEFAULT 'BRL'::character varying,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'confirmed'::character varying, 'processing'::character varying, 'shipped'::character varying, 'delivered'::character varying, 'cancelled'::character varying, 'refunded'::character varying]::text[])),
  payment_status character varying DEFAULT 'pending'::character varying CHECK (payment_status::text = ANY (ARRAY['pending'::character varying, 'paid'::character varying, 'failed'::character varying, 'refunded'::character varying, 'partially_refunded'::character varying]::text[])),
  payment_method character varying,
  payment_reference character varying,
  shipping_method character varying,
  tracking_number character varying,
  notes text,
  tags jsonb DEFAULT '[]'::jsonb,
  order_date timestamp with time zone DEFAULT now(),
  shipped_at timestamp with time zone,
  delivered_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ecommerce_orders_pkey PRIMARY KEY (id),
  CONSTRAINT ecommerce_orders_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.ecommerce_product_variants (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  product_id uuid,
  sku character varying NOT NULL,
  name character varying,
  option1_name character varying,
  option1_value character varying,
  option2_name character varying,
  option2_value character varying,
  option3_name character varying,
  option3_value character varying,
  price numeric,
  compare_price numeric,
  cost_price numeric,
  inventory_quantity integer DEFAULT 0,
  weight numeric,
  barcode character varying,
  image_url character varying,
  requires_shipping boolean DEFAULT true,
  taxable boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ecommerce_product_variants_pkey PRIMARY KEY (id),
  CONSTRAINT ecommerce_product_variants_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.ecommerce_products(id)
);
CREATE TABLE public.ecommerce_products (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  sku character varying NOT NULL,
  name character varying NOT NULL,
  description text,
  short_description text,
  category character varying,
  subcategory character varying,
  brand character varying,
  type character varying CHECK (type::text = ANY (ARRAY['physical'::character varying, 'digital'::character varying, 'service'::character varying, 'subscription'::character varying]::text[])),
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'discontinued'::character varying, 'out_of_stock'::character varying]::text[])),
  price numeric NOT NULL,
  compare_price numeric,
  cost_price numeric,
  currency character varying DEFAULT 'BRL'::character varying,
  weight numeric,
  dimensions jsonb DEFAULT '{}'::jsonb,
  inventory_quantity integer DEFAULT 0,
  inventory_policy character varying DEFAULT 'track'::character varying CHECK (inventory_policy::text = ANY (ARRAY['track'::character varying, 'continue'::character varying, 'deny'::character varying]::text[])),
  requires_shipping boolean DEFAULT true,
  taxable boolean DEFAULT true,
  tax_category character varying,
  vendor character varying,
  images jsonb DEFAULT '[]'::jsonb,
  tags jsonb DEFAULT '[]'::jsonb,
  seo_title character varying,
  seo_description text,
  meta_fields jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ecommerce_products_pkey PRIMARY KEY (id),
  CONSTRAINT ecommerce_products_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.email_campaigns (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  type character varying CHECK (type::text = ANY (ARRAY['newsletter'::character varying, 'nurturing'::character varying, 'cold_outreach'::character varying, 'follow_up'::character varying, 'promotional'::character varying]::text[])),
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'scheduled'::character varying, 'sending'::character varying, 'sent'::character varying, 'paused'::character varying, 'completed'::character varying]::text[])),
  subject_line character varying,
  preview_text character varying,
  sender_name character varying,
  sender_email character varying,
  template_id uuid,
  content_html text,
  content_text text,
  scheduled_at timestamp with time zone,
  sent_at timestamp with time zone,
  recipients_count integer DEFAULT 0,
  delivered_count integer DEFAULT 0,
  opened_count integer DEFAULT 0,
  clicked_count integer DEFAULT 0,
  bounced_count integer DEFAULT 0,
  unsubscribed_count integer DEFAULT 0,
  tags jsonb DEFAULT '[]'::jsonb,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_campaigns_pkey PRIMARY KEY (id),
  CONSTRAINT email_campaigns_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT email_campaigns_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.email_contacts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  email character varying NOT NULL,
  first_name character varying,
  last_name character varying,
  full_name character varying,
  company character varying,
  position character varying,
  phone character varying,
  source character varying,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'bounced'::character varying, 'unsubscribed'::character varying, 'inactive'::character varying]::text[])),
  tags jsonb DEFAULT '[]'::jsonb,
  custom_fields jsonb DEFAULT '{}'::jsonb,
  last_activity timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_contacts_pkey PRIMARY KEY (id),
  CONSTRAINT email_contacts_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.email_sequence_emails (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  sequence_id uuid,
  template_id uuid,
  step_number integer NOT NULL,
  delay_hours integer DEFAULT 0,
  subject character varying,
  content_html text,
  content_text text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_sequence_emails_pkey PRIMARY KEY (id),
  CONSTRAINT email_sequence_emails_sequence_id_fkey FOREIGN KEY (sequence_id) REFERENCES public.email_sequences(id),
  CONSTRAINT email_sequence_emails_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.email_templates(id)
);
CREATE TABLE public.email_sequences (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  trigger_event character varying,
  is_active boolean DEFAULT true,
  total_emails integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_sequences_pkey PRIMARY KEY (id),
  CONSTRAINT email_sequences_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT email_sequences_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.email_templates (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  category character varying,
  type character varying CHECK (type::text = ANY (ARRAY['welcome'::character varying, 'follow_up'::character varying, 'proposal'::character varying, 'newsletter'::character varying, 'notification'::character varying]::text[])),
  subject character varying,
  content_html text NOT NULL,
  content_text text,
  variables jsonb DEFAULT '[]'::jsonb,
  is_active boolean DEFAULT true,
  usage_count integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_templates_pkey PRIMARY KEY (id),
  CONSTRAINT email_templates_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT email_templates_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.empresas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  codigo character varying NOT NULL UNIQUE,
  nome character varying NOT NULL,
  descricao text NOT NULL,
  pais character varying NOT NULL DEFAULT 'BR'::character varying,
  idiomas ARRAY NOT NULL DEFAULT ARRAY['pt'::text],
  total_personas integer NOT NULL DEFAULT 20,
  status character varying NOT NULL DEFAULT 'ativa'::character varying CHECK (status::text = ANY (ARRAY['ativa'::character varying, 'inativa'::character varying, 'processando'::character varying]::text[])),
  scripts_status jsonb NOT NULL DEFAULT '{"rag": false, "fluxos": false, "workflows": false, "biografias": false, "tech_specs": false, "competencias": false}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  ceo_gender character varying DEFAULT 'feminino'::character varying,
  executives_male integer DEFAULT 0,
  executives_female integer DEFAULT 0,
  assistants_male integer DEFAULT 0,
  assistants_female integer DEFAULT 0,
  specialists_male integer DEFAULT 0,
  specialists_female integer DEFAULT 0,
  industry character varying DEFAULT 'tecnologia'::character varying,
  nationalities jsonb DEFAULT '[]'::jsonb,
  dominio character varying,
  industria character varying NOT NULL DEFAULT 'tecnologia'::character varying,
  CONSTRAINT empresas_pkey PRIMARY KEY (id)
);
CREATE TABLE public.financial_accounts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  name character varying NOT NULL,
  type character varying CHECK (type::text = ANY (ARRAY['checking'::character varying, 'savings'::character varying, 'credit_card'::character varying, 'investment'::character varying, 'loan'::character varying, 'other'::character varying]::text[])),
  account_number character varying,
  bank character varying,
  currency character varying DEFAULT 'BRL'::character varying,
  balance numeric DEFAULT 0.00,
  available_balance numeric DEFAULT 0.00,
  credit_limit numeric,
  is_active boolean DEFAULT true,
  last_sync timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT financial_accounts_pkey PRIMARY KEY (id),
  CONSTRAINT financial_accounts_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.financial_budgets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  category character varying,
  period character varying CHECK (period::text = ANY (ARRAY['monthly'::character varying, 'quarterly'::character varying, 'yearly'::character varying]::text[])),
  start_date date NOT NULL,
  end_date date NOT NULL,
  budgeted_amount numeric NOT NULL,
  spent_amount numeric DEFAULT 0.00,
  remaining_amount numeric DEFAULT (budgeted_amount - spent_amount),
  currency character varying DEFAULT 'BRL'::character varying,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'completed'::character varying, 'cancelled'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT financial_budgets_pkey PRIMARY KEY (id),
  CONSTRAINT financial_budgets_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT financial_budgets_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.financial_invoice_items (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  invoice_id uuid,
  product_name character varying NOT NULL,
  description text,
  quantity numeric NOT NULL DEFAULT 1.000,
  unit_price numeric NOT NULL,
  total_price numeric NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT financial_invoice_items_pkey PRIMARY KEY (id),
  CONSTRAINT financial_invoice_items_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES public.financial_invoices(id)
);
CREATE TABLE public.financial_invoices (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  invoice_number character varying NOT NULL,
  customer_name character varying NOT NULL,
  customer_email character varying,
  customer_address text,
  issue_date date NOT NULL,
  due_date date NOT NULL,
  payment_date date,
  subtotal numeric NOT NULL DEFAULT 0.00,
  tax_amount numeric DEFAULT 0.00,
  discount_amount numeric DEFAULT 0.00,
  total_amount numeric NOT NULL DEFAULT 0.00,
  currency character varying DEFAULT 'BRL'::character varying,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'sent'::character varying, 'paid'::character varying, 'overdue'::character varying, 'cancelled'::character varying, 'refunded'::character varying]::text[])),
  payment_terms character varying,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT financial_invoices_pkey PRIMARY KEY (id),
  CONSTRAINT financial_invoices_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT financial_invoices_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.financial_transactions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  account_id uuid,
  persona_id uuid,
  type character varying CHECK (type::text = ANY (ARRAY['income'::character varying, 'expense'::character varying, 'transfer'::character varying, 'refund'::character varying, 'fee'::character varying]::text[])),
  category character varying,
  subcategory character varying,
  description text NOT NULL,
  amount numeric NOT NULL,
  currency character varying DEFAULT 'BRL'::character varying,
  transaction_date date NOT NULL,
  due_date date,
  payment_method character varying,
  reference_number character varying,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'completed'::character varying, 'cancelled'::character varying, 'failed'::character varying, 'refunded'::character varying]::text[])),
  is_recurring boolean DEFAULT false,
  recurring_frequency character varying,
  recurring_until date,
  tags jsonb DEFAULT '[]'::jsonb,
  attachments jsonb DEFAULT '[]'::jsonb,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT financial_transactions_pkey PRIMARY KEY (id),
  CONSTRAINT financial_transactions_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT financial_transactions_account_id_fkey FOREIGN KEY (account_id) REFERENCES public.financial_accounts(id),
  CONSTRAINT financial_transactions_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.hr_departments (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  name character varying NOT NULL,
  description text,
  manager_employee_id uuid,
  budget numeric,
  employee_count integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT hr_departments_pkey PRIMARY KEY (id),
  CONSTRAINT hr_departments_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT hr_departments_manager_employee_id_fkey FOREIGN KEY (manager_employee_id) REFERENCES public.hr_employees(id)
);
CREATE TABLE public.hr_employees (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid UNIQUE,
  employee_number character varying NOT NULL UNIQUE,
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  full_name character varying NOT NULL,
  email character varying NOT NULL,
  phone character varying,
  department character varying,
  position character varying,
  manager_id uuid,
  hire_date date NOT NULL,
  termination_date date,
  employment_status character varying DEFAULT 'active'::character varying CHECK (employment_status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'terminated'::character varying, 'on_leave'::character varying]::text[])),
  employment_type character varying CHECK (employment_type::text = ANY (ARRAY['full_time'::character varying, 'part_time'::character varying, 'contract'::character varying, 'intern'::character varying, 'consultant'::character varying]::text[])),
  salary numeric,
  currency character varying DEFAULT 'BRL'::character varying,
  salary_frequency character varying DEFAULT 'monthly'::character varying,
  address text,
  emergency_contact jsonb DEFAULT '{}'::jsonb,
  skills jsonb DEFAULT '[]'::jsonb,
  certifications jsonb DEFAULT '[]'::jsonb,
  performance_rating numeric,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT hr_employees_pkey PRIMARY KEY (id),
  CONSTRAINT hr_employees_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT hr_employees_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id),
  CONSTRAINT hr_employees_manager_id_fkey FOREIGN KEY (manager_id) REFERENCES public.hr_employees(id)
);
CREATE TABLE public.hr_payroll (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  employee_id uuid,
  period_start date NOT NULL,
  period_end date NOT NULL,
  base_salary numeric NOT NULL,
  overtime_hours numeric DEFAULT 0.00,
  overtime_rate numeric DEFAULT 0.00,
  overtime_pay numeric DEFAULT 0.00,
  bonuses numeric DEFAULT 0.00,
  commissions numeric DEFAULT 0.00,
  allowances numeric DEFAULT 0.00,
  gross_pay numeric NOT NULL,
  tax_deductions numeric DEFAULT 0.00,
  insurance_deductions numeric DEFAULT 0.00,
  other_deductions numeric DEFAULT 0.00,
  total_deductions numeric DEFAULT 0.00,
  net_pay numeric NOT NULL,
  currency character varying DEFAULT 'BRL'::character varying,
  payment_date date,
  payment_method character varying,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'processed'::character varying, 'paid'::character varying, 'cancelled'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT hr_payroll_pkey PRIMARY KEY (id),
  CONSTRAINT hr_payroll_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT hr_payroll_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.hr_employees(id)
);
CREATE TABLE public.hr_performance_reviews (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  employee_id uuid,
  reviewer_id uuid,
  review_period_start date NOT NULL,
  review_period_end date NOT NULL,
  review_type character varying CHECK (review_type::text = ANY (ARRAY['annual'::character varying, 'quarterly'::character varying, 'probation'::character varying, 'project_based'::character varying]::text[])),
  overall_rating numeric,
  goals_achievement numeric,
  competencies jsonb DEFAULT '{}'::jsonb,
  strengths text,
  areas_for_improvement text,
  goals_next_period text,
  development_plan text,
  reviewer_comments text,
  employee_comments text,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'cancelled'::character varying]::text[])),
  due_date date,
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT hr_performance_reviews_pkey PRIMARY KEY (id),
  CONSTRAINT hr_performance_reviews_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT hr_performance_reviews_employee_id_fkey FOREIGN KEY (employee_id) REFERENCES public.hr_employees(id),
  CONSTRAINT hr_performance_reviews_reviewer_id_fkey FOREIGN KEY (reviewer_id) REFERENCES public.hr_employees(id)
);
CREATE TABLE public.learning_patterns (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  pattern_type character varying NOT NULL,
  pattern_category character varying,
  scope_type character varying NOT NULL,
  scope_identifier character varying,
  pattern_description text NOT NULL,
  pattern_data jsonb NOT NULL,
  statistical_confidence numeric CHECK (statistical_confidence >= 0::numeric AND statistical_confidence <= 1::numeric),
  sample_size integer NOT NULL,
  observation_period_days integer NOT NULL,
  impact_magnitude numeric,
  frequency_score numeric,
  consistency_score numeric,
  applied boolean DEFAULT false,
  application_date timestamp with time zone,
  measured_improvement numeric,
  rollback_triggered boolean DEFAULT false,
  detected_at timestamp with time zone DEFAULT now(),
  last_validated timestamp with time zone DEFAULT now(),
  is_active boolean DEFAULT true,
  validation_count integer DEFAULT 1,
  CONSTRAINT learning_patterns_pkey PRIMARY KEY (id),
  CONSTRAINT learning_patterns_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.marketing_ads (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  campaign_id uuid,
  name character varying NOT NULL,
  type character varying CHECK (type::text = ANY (ARRAY['text'::character varying, 'display'::character varying, 'video'::character varying, 'shopping'::character varying, 'app'::character varying, 'responsive'::character varying]::text[])),
  headline character varying,
  description text,
  call_to_action character varying,
  display_url character varying,
  final_url character varying,
  image_url character varying,
  video_url character varying,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'active'::character varying, 'paused'::character varying, 'removed'::character varying]::text[])),
  bid_amount numeric,
  quality_score integer,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT marketing_ads_pkey PRIMARY KEY (id),
  CONSTRAINT marketing_ads_campaign_id_fkey FOREIGN KEY (campaign_id) REFERENCES public.marketing_campaigns(id)
);
CREATE TABLE public.marketing_campaigns (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  type character varying CHECK (type::text = ANY (ARRAY['google_ads'::character varying, 'facebook_ads'::character varying, 'linkedin_ads'::character varying, 'email_marketing'::character varying, 'content_marketing'::character varying, 'seo'::character varying, 'influencer'::character varying]::text[])),
  objective character varying,
  budget numeric,
  daily_budget numeric,
  start_date date,
  end_date date,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'active'::character varying, 'paused'::character varying, 'completed'::character varying, 'cancelled'::character varying]::text[])),
  target_audience jsonb DEFAULT '{}'::jsonb,
  targeting_criteria jsonb DEFAULT '{}'::jsonb,
  keywords jsonb DEFAULT '[]'::jsonb,
  ad_groups jsonb DEFAULT '[]'::jsonb,
  landing_page_url character varying,
  utm_source character varying,
  utm_medium character varying,
  utm_campaign character varying,
  utm_content character varying,
  utm_term character varying,
  conversion_goals jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT marketing_campaigns_pkey PRIMARY KEY (id),
  CONSTRAINT marketing_campaigns_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT marketing_campaigns_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.marketing_metrics (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  campaign_id uuid,
  ad_id uuid,
  date date NOT NULL,
  platform character varying,
  impressions integer DEFAULT 0,
  clicks integer DEFAULT 0,
  conversions integer DEFAULT 0,
  cost numeric DEFAULT 0.00,
  revenue numeric DEFAULT 0.00,
  ctr numeric DEFAULT 0.0000,
  cpc numeric DEFAULT 0.00,
  cpm numeric DEFAULT 0.00,
  conversion_rate numeric DEFAULT 0.0000,
  roas numeric DEFAULT 0.0000,
  quality_score integer,
  position numeric,
  search_impression_share numeric,
  raw_data jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT marketing_metrics_pkey PRIMARY KEY (id),
  CONSTRAINT marketing_metrics_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT marketing_metrics_campaign_id_fkey FOREIGN KEY (campaign_id) REFERENCES public.marketing_campaigns(id),
  CONSTRAINT marketing_metrics_ad_id_fkey FOREIGN KEY (ad_id) REFERENCES public.marketing_ads(id)
);
CREATE TABLE public.metas_globais (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid NOT NULL,
  titulo character varying NOT NULL,
  descricao text NOT NULL,
  prazo date NOT NULL,
  prioridade character varying NOT NULL DEFAULT 'media'::character varying CHECK (prioridade::text = ANY (ARRAY['baixa'::character varying, 'media'::character varying, 'alta'::character varying, 'critica'::character varying]::text[])),
  categoria character varying NOT NULL DEFAULT 'crescimento'::character varying CHECK (categoria::text = ANY (ARRAY['crescimento'::character varying, 'operacional'::character varying, 'financeira'::character varying, 'inovacao'::character varying, 'sustentabilidade'::character varying]::text[])),
  progresso integer DEFAULT 0 CHECK (progresso >= 0 AND progresso <= 100),
  status character varying NOT NULL DEFAULT 'ativa'::character varying CHECK (status::text = ANY (ARRAY['ativa'::character varying, 'pausada'::character varying, 'concluida'::character varying, 'cancelada'::character varying]::text[])),
  responsavel_principal character varying,
  indicadores_sucesso ARRAY,
  budget_estimado numeric,
  roi_esperado numeric,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT metas_globais_pkey PRIMARY KEY (id),
  CONSTRAINT metas_globais_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.metas_personas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  meta_global_id uuid NOT NULL,
  persona_id uuid NOT NULL,
  titulo character varying NOT NULL,
  descricao text NOT NULL,
  tipo_persona character varying NOT NULL CHECK (tipo_persona::text = ANY (ARRAY['executivo'::character varying, 'especialista'::character varying, 'assistente'::character varying]::text[])),
  prazo date NOT NULL,
  progresso integer DEFAULT 0 CHECK (progresso >= 0 AND progresso <= 100),
  alinhamento_score integer DEFAULT 0 CHECK (alinhamento_score >= 0 AND alinhamento_score <= 100),
  status character varying NOT NULL DEFAULT 'ativa'::character varying CHECK (status::text = ANY (ARRAY['ativa'::character varying, 'pausada'::character varying, 'concluida'::character varying, 'cancelada'::character varying]::text[])),
  dependencias ARRAY,
  recursos_necessarios ARRAY,
  milestones jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT metas_personas_pkey PRIMARY KEY (id),
  CONSTRAINT metas_personas_meta_global_id_fkey FOREIGN KEY (meta_global_id) REFERENCES public.metas_globais(id),
  CONSTRAINT metas_personas_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.ml_feedback_loop (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  feedback_source character varying NOT NULL,
  source_reference_id uuid,
  feedback_type character varying NOT NULL,
  feedback_category character varying,
  feedback_content jsonb NOT NULL,
  feedback_score numeric,
  feedback_text text,
  context_data jsonb DEFAULT '{}'::jsonb,
  related_patterns ARRAY DEFAULT '{}'::text[],
  processed boolean DEFAULT false,
  processing_result jsonb DEFAULT '{}'::jsonb,
  action_taken character varying,
  impact_assessment jsonb DEFAULT '{}'::jsonb,
  received_at timestamp with time zone DEFAULT now(),
  processed_at timestamp with time zone,
  CONSTRAINT ml_feedback_loop_pkey PRIMARY KEY (id),
  CONSTRAINT ml_feedback_loop_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.ml_system_config (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  learning_enabled boolean DEFAULT true,
  auto_optimization_enabled boolean DEFAULT true,
  confidence_threshold numeric DEFAULT 0.80,
  min_sample_size integer DEFAULT 10,
  observation_window_days integer DEFAULT 14,
  performance_tracking_enabled boolean DEFAULT true,
  anomaly_detection_enabled boolean DEFAULT true,
  anomaly_sensitivity numeric DEFAULT 0.95,
  require_human_approval boolean DEFAULT false,
  auto_rollback_enabled boolean DEFAULT true,
  rollback_threshold_hours integer DEFAULT 24,
  max_optimization_frequency_hours integer DEFAULT 6,
  alert_enabled boolean DEFAULT true,
  critical_alert_threshold numeric DEFAULT 0.20,
  warning_alert_threshold numeric DEFAULT 0.10,
  experimental_features_enabled boolean DEFAULT false,
  custom_ml_rules jsonb DEFAULT '{}'::jsonb,
  integration_settings jsonb DEFAULT '{}'::jsonb,
  config_version character varying DEFAULT '1.0'::character varying,
  last_updated_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ml_system_config_pkey PRIMARY KEY (id),
  CONSTRAINT ml_system_config_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT ml_system_config_last_updated_by_fkey FOREIGN KEY (last_updated_by) REFERENCES public.personas(id)
);
CREATE TABLE public.n8n_workflows (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  workflow_name text NOT NULL,
  workflow_type text NOT NULL,
  nodes jsonb DEFAULT '[]'::jsonb,
  connections jsonb DEFAULT '{}'::jsonb,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT n8n_workflows_pkey PRIMARY KEY (id),
  CONSTRAINT n8n_workflows_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.objetivos (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  persona_id uuid,
  objetivo_tipo text NOT NULL,
  titulo text NOT NULL,
  descricao text,
  meta_valor numeric,
  meta_unidade text,
  prazo date,
  status text DEFAULT 'ativo'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT objetivos_pkey PRIMARY KEY (id),
  CONSTRAINT objetivos_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT objetivos_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.optimization_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  pattern_id uuid,
  evolution_log_id uuid,
  optimization_type character varying NOT NULL,
  optimization_name character varying NOT NULL,
  optimization_description text,
  target_scope character varying NOT NULL,
  target_identifiers ARRAY DEFAULT '{}'::text[],
  optimization_parameters jsonb NOT NULL,
  expected_outcomes jsonb DEFAULT '{}'::jsonb,
  success_criteria jsonb DEFAULT '{}'::jsonb,
  implementation_method character varying,
  implementation_details jsonb DEFAULT '{}'::jsonb,
  rollout_percentage numeric DEFAULT 100.0,
  measured_at timestamp with time zone,
  actual_outcomes jsonb DEFAULT '{}'::jsonb,
  success_score numeric CHECK (success_score >= 0::numeric AND success_score <= 1::numeric),
  improvement_achieved numeric,
  side_effects jsonb DEFAULT '{}'::jsonb,
  status character varying DEFAULT 'implemented'::character varying CHECK (status::text = ANY (ARRAY['planned'::character varying, 'implementing'::character varying, 'implemented'::character varying, 'measuring'::character varying, 'successful'::character varying, 'failed'::character varying, 'rolled_back'::character varying]::text[])),
  auto_applied boolean DEFAULT true,
  human_reviewed boolean DEFAULT false,
  reviewed_by uuid,
  review_notes text,
  planned_at timestamp with time zone DEFAULT now(),
  implemented_at timestamp with time zone,
  measurement_period_days integer DEFAULT 7,
  next_evaluation timestamp with time zone,
  rollback_reason text,
  rolled_back_at timestamp with time zone,
  CONSTRAINT optimization_history_pkey PRIMARY KEY (id),
  CONSTRAINT optimization_history_pattern_id_fkey FOREIGN KEY (pattern_id) REFERENCES public.learning_patterns(id),
  CONSTRAINT optimization_history_evolution_log_id_fkey FOREIGN KEY (evolution_log_id) REFERENCES public.system_evolution_log(id),
  CONSTRAINT optimization_history_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.personas(id),
  CONSTRAINT optimization_history_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.performance_metrics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  metric_scope character varying NOT NULL,
  scope_id character varying,
  metric_name character varying NOT NULL,
  metric_category character varying NOT NULL,
  metric_description text,
  metric_value numeric NOT NULL,
  baseline_value numeric,
  target_value numeric,
  unit_of_measure character varying,
  measurement_period character varying,
  period_start date NOT NULL,
  period_end date NOT NULL,
  calculation_method text,
  data_quality_score numeric CHECK (data_quality_score >= 0::numeric AND data_quality_score <= 1::numeric),
  sample_size integer,
  confidence_interval jsonb,
  trend_direction character varying CHECK (trend_direction::text = ANY (ARRAY['improving'::character varying, 'declining'::character varying, 'stable'::character varying, 'volatile'::character varying]::text[])),
  significance_level character varying CHECK (significance_level::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying]::text[])),
  anomaly_detected boolean DEFAULT false,
  measured_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT performance_metrics_pkey PRIMARY KEY (id),
  CONSTRAINT performance_metrics_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.persona_collection_access (
  persona_id uuid NOT NULL,
  collection_id uuid NOT NULL,
  role text NOT NULL DEFAULT 'reader'::text CHECK (role = ANY (ARRAY['reader'::text, 'editor'::text, 'owner'::text])),
  granted_at timestamp with time zone DEFAULT now(),
  granted_by uuid,
  CONSTRAINT persona_collection_access_pkey PRIMARY KEY (persona_id, collection_id),
  CONSTRAINT persona_collection_access_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id),
  CONSTRAINT persona_collection_access_collection_id_fkey FOREIGN KEY (collection_id) REFERENCES public.rag_collections(id)
);
CREATE TABLE public.persona_tasks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  persona_id uuid,
  task_id character varying NOT NULL UNIQUE,
  title character varying NOT NULL,
  description text,
  task_type character varying CHECK (task_type::text = ANY (ARRAY['daily'::character varying, 'weekly'::character varying, 'monthly'::character varying, 'ad_hoc'::character varying]::text[])),
  priority character varying DEFAULT 'MEDIUM'::character varying CHECK (priority::text = ANY (ARRAY['LOW'::character varying, 'MEDIUM'::character varying, 'HIGH'::character varying, 'URGENT'::character varying]::text[])),
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'cancelled'::character varying, 'overdue'::character varying]::text[])),
  estimated_duration integer,
  actual_duration integer,
  due_date timestamp with time zone,
  completed_at timestamp with time zone,
  required_subsystems jsonb DEFAULT '[]'::jsonb,
  inputs_from jsonb DEFAULT '[]'::jsonb,
  outputs_to jsonb DEFAULT '[]'::jsonb,
  success_criteria text,
  complexity_score integer CHECK (complexity_score >= 1 AND complexity_score <= 10),
  ai_generated boolean DEFAULT true,
  generation_context jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT persona_tasks_pkey PRIMARY KEY (id),
  CONSTRAINT persona_tasks_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT persona_tasks_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.personas (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_code character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  role character varying NOT NULL,
  specialty character varying,
  department character varying,
  email character varying NOT NULL UNIQUE,
  whatsapp character varying NOT NULL,
  empresa_id uuid NOT NULL,
  biografia_completa text,
  personalidade jsonb DEFAULT '{}'::jsonb,
  experiencia_anos integer DEFAULT 0,
  ia_config jsonb DEFAULT '{}'::jsonb,
  temperatura_ia numeric DEFAULT 0.7,
  max_tokens integer DEFAULT 2000,
  system_prompt text,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'archived'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  last_sync timestamp with time zone DEFAULT now(),
  CONSTRAINT personas_pkey PRIMARY KEY (id),
  CONSTRAINT personas_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.personas_atribuicoes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_id uuid,
  empresa_id uuid,
  reporting_to uuid,
  subordinados ARRAY DEFAULT '{}'::uuid[],
  departamento text NOT NULL,
  nivel_hierarquico integer NOT NULL,
  email_corporativo text NOT NULL UNIQUE,
  sistema_ci_username text NOT NULL UNIQUE,
  sistema_ci_token uuid DEFAULT gen_random_uuid(),
  permissoes ARRAY DEFAULT '{}'::text[],
  sistemas_acesso ARRAY DEFAULT '{}'::text[],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT personas_atribuicoes_pkey PRIMARY KEY (id),
  CONSTRAINT personas_atribuicoes_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id),
  CONSTRAINT personas_atribuicoes_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT personas_atribuicoes_reporting_to_fkey FOREIGN KEY (reporting_to) REFERENCES public.personas(id)
);
CREATE TABLE public.personas_biografias (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_id uuid NOT NULL UNIQUE,
  biografia_completa text NOT NULL,
  historia_profissional text,
  motivacoes jsonb DEFAULT '{}'::jsonb,
  desafios jsonb DEFAULT '{}'::jsonb,
  objetivos_pessoais ARRAY,
  soft_skills jsonb DEFAULT '{}'::jsonb,
  hard_skills jsonb DEFAULT '{}'::jsonb,
  educacao jsonb DEFAULT '{}'::jsonb,
  certificacoes ARRAY,
  idiomas_fluencia jsonb DEFAULT '{}'::jsonb,
  experiencia_internacional jsonb DEFAULT '{}'::jsonb,
  redes_sociais jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT personas_biografias_pkey PRIMARY KEY (id),
  CONSTRAINT personas_biografias_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.personas_tech_specs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_id uuid NOT NULL UNIQUE,
  ai_model character varying NOT NULL DEFAULT 'gpt-4-turbo-preview'::character varying,
  max_tokens integer NOT NULL DEFAULT 2000 CHECK (max_tokens > 0 AND max_tokens <= 8000),
  temperature numeric NOT NULL DEFAULT 0.7 CHECK (temperature >= 0::numeric AND temperature <= 2::numeric),
  response_format character varying NOT NULL DEFAULT 'structured'::character varying CHECK (response_format::text = ANY (ARRAY['structured'::character varying, 'creative'::character varying, 'analytical'::character varying, 'conversational'::character varying]::text[])),
  priority_level character varying NOT NULL DEFAULT 'medium'::character varying CHECK (priority_level::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying]::text[])),
  decision_authority character varying NOT NULL DEFAULT 'operational'::character varying CHECK (decision_authority::text = ANY (ARRAY['none'::character varying, 'operational'::character varying, 'tactical'::character varying, 'strategic'::character varying, 'full'::character varying]::text[])),
  access_scope character varying NOT NULL DEFAULT 'department'::character varying,
  tools_habilitadas jsonb DEFAULT '[]'::jsonb,
  integraes_sistemas jsonb DEFAULT '[]'::jsonb,
  limitaes jsonb DEFAULT '{}'::jsonb,
  configurao_avanada jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT personas_tech_specs_pkey PRIMARY KEY (id),
  CONSTRAINT personas_tech_specs_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.rag_chunks (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  document_id uuid NOT NULL,
  chunk_index integer NOT NULL,
  content text NOT NULL,
  content_length integer,
  tokens integer,
  metadata jsonb DEFAULT '{}'::jsonb,
  start_char integer,
  end_char integer,
  overlap_prev integer DEFAULT 0,
  overlap_next integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  embedding USER-DEFINED,
  CONSTRAINT rag_chunks_pkey PRIMARY KEY (id),
  CONSTRAINT rag_chunks_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.rag_documents(id)
);
CREATE TABLE public.rag_collections (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  code text NOT NULL UNIQUE,
  name text NOT NULL,
  description text,
  visibility text NOT NULL DEFAULT 'public'::text CHECK (visibility = ANY (ARRAY['public'::text, 'internal'::text, 'restricted'::text])),
  tags ARRAY DEFAULT ARRAY[]::text[],
  metadata jsonb DEFAULT '{}'::jsonb,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rag_collections_pkey PRIMARY KEY (id)
);
CREATE TABLE public.rag_config_empresa (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid NOT NULL UNIQUE,
  chunk_size integer DEFAULT 1000,
  chunk_overlap integer DEFAULT 200,
  embedding_model character varying DEFAULT 'text-embedding-ada-002'::character varying,
  similarity_threshold numeric DEFAULT 0.7,
  max_results integer DEFAULT 5,
  auto_sync boolean DEFAULT true,
  last_sync timestamp with time zone,
  settings jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rag_config_empresa_pkey PRIMARY KEY (id)
);
CREATE TABLE public.rag_documents (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  collection_id uuid NOT NULL,
  external_id text NOT NULL,
  title text NOT NULL,
  content_raw text,
  content_length integer,
  language text NOT NULL DEFAULT 'en'::text,
  version text DEFAULT 'latest'::text,
  document_type text,
  source_url text,
  checksum text,
  metadata jsonb DEFAULT '{}'::jsonb,
  tags ARRAY DEFAULT ARRAY[]::text[],
  is_active boolean DEFAULT true,
  processed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  embedding USER-DEFINED,
  empresa_id uuid,
  source_type character varying DEFAULT 'manual'::character varying,
  persona_id uuid,
  CONSTRAINT rag_documents_pkey PRIMARY KEY (id),
  CONSTRAINT rag_documents_collection_id_fkey FOREIGN KEY (collection_id) REFERENCES public.rag_collections(id)
);
CREATE TABLE public.rag_eval_items (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  eval_set_id uuid NOT NULL,
  query text NOT NULL,
  expected_chunks ARRAY DEFAULT ARRAY[]::uuid[],
  expected_answer text,
  difficulty_level integer CHECK (difficulty_level >= 1 AND difficulty_level <= 5),
  tags ARRAY DEFAULT ARRAY[]::text[],
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rag_eval_items_pkey PRIMARY KEY (id),
  CONSTRAINT rag_eval_items_eval_set_id_fkey FOREIGN KEY (eval_set_id) REFERENCES public.rag_eval_sets(id)
);
CREATE TABLE public.rag_eval_sets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name text NOT NULL UNIQUE,
  description text,
  persona_id uuid,
  collection_ids ARRAY DEFAULT ARRAY[]::uuid[],
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rag_eval_sets_pkey PRIMARY KEY (id)
);
CREATE TABLE public.rag_feedback (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  persona_id uuid,
  session_id text,
  query text NOT NULL,
  answer_quality integer CHECK (answer_quality >= 1 AND answer_quality <= 5),
  relevance_score numeric CHECK (relevance_score >= 0::numeric AND relevance_score <= 1::numeric),
  response_time_ms integer,
  reasons text,
  top_citations jsonb DEFAULT '[]'::jsonb,
  metadata jsonb DEFAULT '{}'::jsonb,
  user_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rag_feedback_pkey PRIMARY KEY (id)
);
CREATE TABLE public.rag_ingestion_jobs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid NOT NULL,
  job_type character varying NOT NULL,
  status character varying DEFAULT 'pending'::character varying,
  total_items integer DEFAULT 0,
  processed_items integer DEFAULT 0,
  success_items integer DEFAULT 0,
  failed_items integer DEFAULT 0,
  error_details jsonb DEFAULT '[]'::jsonb,
  started_at timestamp with time zone,
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rag_ingestion_jobs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.rag_ingestion_logs (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  document_id uuid,
  status text NOT NULL CHECK (status = ANY (ARRAY['pending'::text, 'processing'::text, 'completed'::text, 'failed'::text, 'retrying'::text])),
  operation text NOT NULL,
  chunks_created integer DEFAULT 0,
  chunks_updated integer DEFAULT 0,
  processing_time_ms integer,
  error_message text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  completed_at timestamp with time zone,
  CONSTRAINT rag_ingestion_logs_pkey PRIMARY KEY (id),
  CONSTRAINT rag_ingestion_logs_document_id_fkey FOREIGN KEY (document_id) REFERENCES public.rag_documents(id)
);
CREATE TABLE public.rag_knowledge (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_id uuid NOT NULL,
  tipo character varying NOT NULL CHECK (tipo::text = ANY (ARRAY['politica'::character varying, 'procedimento'::character varying, 'documento'::character varying, 'faq'::character varying]::text[])),
  titulo character varying NOT NULL,
  conteudo text NOT NULL,
  chunk_size integer DEFAULT 800,
  tokens_count integer,
  categoria character varying,
  tags jsonb DEFAULT '[]'::jsonb,
  relevancia numeric DEFAULT 1.0,
  ativo boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rag_knowledge_pkey PRIMARY KEY (id),
  CONSTRAINT rag_knowledge_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.rag_knowledge_base (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  persona_id uuid,
  content_type text NOT NULL,
  title text NOT NULL,
  content text NOT NULL,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rag_knowledge_base_pkey PRIMARY KEY (id),
  CONSTRAINT rag_knowledge_base_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT rag_knowledge_base_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.security_audit_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  security_event_type character varying NOT NULL,
  severity character varying NOT NULL CHECK (severity::text = ANY (ARRAY['info'::character varying, 'warning'::character varying, 'error'::character varying, 'critical'::character varying]::text[])),
  user_id uuid,
  username character varying,
  ip_address inet NOT NULL,
  user_agent text,
  country_code character varying,
  resource_accessed character varying,
  permission_required character varying,
  permission_granted boolean NOT NULL,
  access_method character varying,
  session_id character varying,
  request_path text,
  http_method character varying,
  query_parameters jsonb,
  success boolean NOT NULL,
  failure_reason text,
  action_taken character varying,
  risk_score integer CHECK (risk_score >= 0 AND risk_score <= 100),
  anomaly_detected boolean DEFAULT false,
  anomaly_reasons ARRAY,
  attempted_at timestamp with time zone DEFAULT now(),
  response_time_ms integer,
  CONSTRAINT security_audit_logs_pkey PRIMARY KEY (id),
  CONSTRAINT security_audit_logs_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT security_audit_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.personas(id)
);
CREATE TABLE public.social_accounts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  platform character varying NOT NULL CHECK (platform::text = ANY (ARRAY['linkedin'::character varying, 'twitter'::character varying, 'facebook'::character varying, 'instagram'::character varying, 'youtube'::character varying, 'tiktok'::character varying]::text[])),
  account_name character varying NOT NULL,
  account_handle character varying,
  account_url character varying,
  access_token text,
  refresh_token text,
  token_expires_at timestamp with time zone,
  is_active boolean DEFAULT true,
  is_connected boolean DEFAULT false,
  follower_count integer DEFAULT 0,
  following_count integer DEFAULT 0,
  last_sync timestamp with time zone,
  settings jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT social_accounts_pkey PRIMARY KEY (id),
  CONSTRAINT social_accounts_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT social_accounts_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.social_campaigns (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  persona_id uuid,
  name character varying NOT NULL,
  description text,
  objective character varying,
  start_date date,
  end_date date,
  budget numeric,
  target_platforms jsonb DEFAULT '[]'::jsonb,
  target_audience jsonb DEFAULT '{}'::jsonb,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'active'::character varying, 'paused'::character varying, 'completed'::character varying, 'cancelled'::character varying]::text[])),
  metrics jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT social_campaigns_pkey PRIMARY KEY (id),
  CONSTRAINT social_campaigns_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT social_campaigns_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.social_posts (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  account_id uuid,
  persona_id uuid,
  content text NOT NULL,
  platform character varying NOT NULL,
  post_type character varying CHECK (post_type::text = ANY (ARRAY['text'::character varying, 'image'::character varying, 'video'::character varying, 'carousel'::character varying, 'story'::character varying, 'reel'::character varying]::text[])),
  media_urls jsonb DEFAULT '[]'::jsonb,
  hashtags jsonb DEFAULT '[]'::jsonb,
  mentions jsonb DEFAULT '[]'::jsonb,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'scheduled'::character varying, 'published'::character varying, 'failed'::character varying, 'cancelled'::character varying]::text[])),
  scheduled_at timestamp with time zone,
  published_at timestamp with time zone,
  external_post_id character varying,
  external_url character varying,
  engagement_stats jsonb DEFAULT '{"likes": 0, "views": 0, "shares": 0, "comments": 0}'::jsonb,
  campaign_id uuid,
  tags jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT social_posts_pkey PRIMARY KEY (id),
  CONSTRAINT social_posts_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT social_posts_account_id_fkey FOREIGN KEY (account_id) REFERENCES public.social_accounts(id),
  CONSTRAINT social_posts_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.support_knowledge_base (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  category character varying,
  title character varying NOT NULL,
  content text NOT NULL,
  excerpt text,
  keywords jsonb DEFAULT '[]'::jsonb,
  tags jsonb DEFAULT '[]'::jsonb,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'published'::character varying, 'archived'::character varying]::text[])),
  helpful_votes integer DEFAULT 0,
  unhelpful_votes integer DEFAULT 0,
  view_count integer DEFAULT 0,
  author_persona_id uuid,
  last_reviewed_at timestamp with time zone,
  reviewed_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT support_knowledge_base_pkey PRIMARY KEY (id),
  CONSTRAINT support_knowledge_base_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT support_knowledge_base_author_persona_id_fkey FOREIGN KEY (author_persona_id) REFERENCES public.personas(id),
  CONSTRAINT support_knowledge_base_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.personas(id)
);
CREATE TABLE public.support_ticket_messages (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  ticket_id uuid,
  persona_id uuid,
  message_type character varying CHECK (message_type::text = ANY (ARRAY['customer_message'::character varying, 'agent_response'::character varying, 'internal_note'::character varying, 'system_message'::character varying]::text[])),
  content text NOT NULL,
  is_public boolean DEFAULT true,
  attachments jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT support_ticket_messages_pkey PRIMARY KEY (id),
  CONSTRAINT support_ticket_messages_ticket_id_fkey FOREIGN KEY (ticket_id) REFERENCES public.support_tickets(id),
  CONSTRAINT support_ticket_messages_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.support_tickets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  empresa_id uuid,
  ticket_number character varying NOT NULL UNIQUE,
  customer_name character varying NOT NULL,
  customer_email character varying NOT NULL,
  customer_phone character varying,
  assigned_persona_id uuid,
  subject character varying NOT NULL,
  description text NOT NULL,
  category character varying,
  subcategory character varying,
  priority character varying DEFAULT 'medium'::character varying CHECK (priority::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'urgent'::character varying]::text[])),
  status character varying DEFAULT 'open'::character varying CHECK (status::text = ANY (ARRAY['open'::character varying, 'in_progress'::character varying, 'pending_customer'::character varying, 'resolved'::character varying, 'closed'::character varying, 'cancelled'::character varying]::text[])),
  source character varying CHECK (source::text = ANY (ARRAY['email'::character varying, 'chat'::character varying, 'phone'::character varying, 'form'::character varying, 'social'::character varying, 'api'::character varying]::text[])),
  channel character varying,
  product character varying,
  sla_deadline timestamp with time zone,
  first_response_at timestamp with time zone,
  resolved_at timestamp with time zone,
  closed_at timestamp with time zone,
  satisfaction_rating integer CHECK (satisfaction_rating >= 1 AND satisfaction_rating <= 5),
  satisfaction_comment text,
  tags jsonb DEFAULT '[]'::jsonb,
  custom_fields jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT support_tickets_pkey PRIMARY KEY (id),
  CONSTRAINT support_tickets_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT support_tickets_assigned_persona_id_fkey FOREIGN KEY (assigned_persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.sync_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid NOT NULL,
  tipo_sync character varying NOT NULL,
  status character varying NOT NULL CHECK (status::text = ANY (ARRAY['success'::character varying, 'error'::character varying, 'partial'::character varying]::text[])),
  registros_processados integer DEFAULT 0,
  registros_sucesso integer DEFAULT 0,
  registros_erro integer DEFAULT 0,
  detalhes jsonb DEFAULT '{}'::jsonb,
  error_log text,
  started_at timestamp with time zone DEFAULT now(),
  finished_at timestamp with time zone,
  duration_seconds integer,
  CONSTRAINT sync_logs_pkey PRIMARY KEY (id),
  CONSTRAINT sync_logs_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.system_alerts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  alert_type character varying NOT NULL,
  severity character varying NOT NULL CHECK (severity::text = ANY (ARRAY['info'::character varying, 'warning'::character varying, 'error'::character varying, 'critical'::character varying]::text[])),
  title character varying NOT NULL,
  description text NOT NULL,
  alert_data jsonb DEFAULT '{}'::jsonb,
  affected_scope character varying,
  affected_entities ARRAY DEFAULT '{}'::text[],
  potential_impact character varying,
  recommended_actions jsonb DEFAULT '[]'::jsonb,
  auto_resolution_attempted boolean DEFAULT false,
  auto_resolution_result jsonb DEFAULT '{}'::jsonb,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'acknowledged'::character varying, 'resolved'::character varying, 'dismissed'::character varying, 'escalated'::character varying]::text[])),
  acknowledged_by uuid,
  acknowledged_at timestamp with time zone,
  resolved_at timestamp with time zone,
  resolution_notes text,
  triggered_at timestamp with time zone DEFAULT now(),
  expires_at timestamp with time zone,
  CONSTRAINT system_alerts_pkey PRIMARY KEY (id),
  CONSTRAINT system_alerts_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT system_alerts_acknowledged_by_fkey FOREIGN KEY (acknowledged_by) REFERENCES public.personas(id)
);
CREATE TABLE public.system_configurations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  key character varying NOT NULL UNIQUE,
  value text NOT NULL,
  category character varying NOT NULL CHECK (category::text = ANY (ARRAY['api'::character varying, 'system'::character varying, 'ui'::character varying, 'sync'::character varying]::text[])),
  description text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT system_configurations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.system_evolution_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  evolution_type character varying NOT NULL,
  evolution_category character varying,
  trigger_source character varying NOT NULL,
  trigger_data jsonb DEFAULT '{}'::jsonb,
  before_state jsonb NOT NULL,
  after_state jsonb NOT NULL,
  change_summary text NOT NULL,
  technical_details jsonb DEFAULT '{}'::jsonb,
  affected_personas ARRAY DEFAULT '{}'::text[],
  affected_subsystems ARRAY DEFAULT '{}'::text[],
  expected_improvement_percent numeric,
  actual_improvement_percent numeric,
  improvement_metric character varying,
  risk_level character varying CHECK (risk_level::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying]::text[])),
  requires_approval boolean DEFAULT false,
  approved_by uuid,
  rollback_data jsonb,
  rollback_available boolean DEFAULT true,
  applied_at timestamp with time zone DEFAULT now(),
  effectiveness_measured_at timestamp with time zone,
  next_review_date timestamp with time zone,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'rolled_back'::character varying, 'superseded'::character varying, 'expired'::character varying]::text[])),
  notes text,
  CONSTRAINT system_evolution_log_pkey PRIMARY KEY (id),
  CONSTRAINT system_evolution_log_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT system_evolution_log_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.personas(id)
);
CREATE TABLE public.task_execution_analytics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_id uuid,
  task_id uuid,
  empresa_id uuid,
  task_title character varying,
  task_type character varying,
  estimated_duration integer,
  actual_duration integer,
  efficiency_ratio numeric,
  complexity_score integer CHECK (complexity_score >= 1 AND complexity_score <= 10),
  success_rate numeric CHECK (success_rate >= 0::numeric AND success_rate <= 1::numeric),
  execution_context jsonb DEFAULT '{}'::jsonb,
  subsystems_used ARRAY DEFAULT '{}'::text[],
  dependencies_met boolean DEFAULT true,
  resource_availability numeric DEFAULT 1.0,
  output_quality_score integer CHECK (output_quality_score >= 1 AND output_quality_score <= 10),
  stakeholder_satisfaction integer CHECK (stakeholder_satisfaction >= 1 AND stakeholder_satisfaction <= 10),
  rework_required boolean DEFAULT false,
  error_count integer DEFAULT 0,
  persona_workload_factor numeric,
  team_coordination_score numeric,
  innovation_score integer CHECK (innovation_score >= 1 AND innovation_score <= 10),
  execution_date date NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT task_execution_analytics_pkey PRIMARY KEY (id),
  CONSTRAINT task_execution_analytics_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id),
  CONSTRAINT task_execution_analytics_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.persona_tasks(id),
  CONSTRAINT task_execution_analytics_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id)
);
CREATE TABLE public.tech_specifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  persona_id uuid,
  role text NOT NULL,
  tools ARRAY DEFAULT '{}'::text[],
  technologies ARRAY DEFAULT '{}'::text[],
  methodologies ARRAY DEFAULT '{}'::text[],
  sales_enablement ARRAY DEFAULT '{}'::text[],
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT tech_specifications_pkey PRIMARY KEY (id),
  CONSTRAINT tech_specifications_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT tech_specifications_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.workflows (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  persona_id uuid NOT NULL,
  nome character varying NOT NULL,
  descricao text,
  tipo character varying NOT NULL CHECK (tipo::text = ANY (ARRAY['tarefa'::character varying, 'fluxo'::character varying, 'responsabilidade'::character varying]::text[])),
  prioridade character varying DEFAULT 'media'::character varying CHECK (prioridade::text = ANY (ARRAY['baixa'::character varying, 'media'::character varying, 'alta'::character varying, 'critica'::character varying]::text[])),
  config jsonb DEFAULT '{}'::jsonb,
  triggers jsonb DEFAULT '[]'::jsonb,
  actions jsonb DEFAULT '[]'::jsonb,
  ativo boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT workflows_pkey PRIMARY KEY (id),
  CONSTRAINT workflows_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);
CREATE TABLE public.workload_analytics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  empresa_id uuid,
  persona_id uuid,
  analysis_date date NOT NULL,
  analysis_period character varying NOT NULL,
  total_tasks integer NOT NULL DEFAULT 0,
  completed_tasks integer NOT NULL DEFAULT 0,
  overdue_tasks integer NOT NULL DEFAULT 0,
  total_estimated_hours numeric NOT NULL DEFAULT 0,
  total_actual_hours numeric DEFAULT 0,
  available_hours numeric NOT NULL DEFAULT 8,
  utilization_rate numeric CHECK (utilization_rate >= 0::numeric),
  average_efficiency numeric,
  task_completion_rate numeric CHECK (task_completion_rate >= 0::numeric AND task_completion_rate <= 1::numeric),
  quality_score numeric,
  stress_indicator numeric CHECK (stress_indicator >= 0::numeric),
  task_type_distribution jsonb DEFAULT '{}'::jsonb,
  complexity_distribution jsonb DEFAULT '{}'::jsonb,
  subsystem_usage jsonb DEFAULT '{}'::jsonb,
  peak_hours jsonb DEFAULT '[]'::jsonb,
  productivity_curve jsonb DEFAULT '{}'::jsonb,
  collaboration_score numeric,
  dependency_wait_time numeric,
  overload_risk boolean DEFAULT false,
  underutilized boolean DEFAULT false,
  skill_mismatch boolean DEFAULT false,
  requires_rebalancing boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT workload_analytics_pkey PRIMARY KEY (id),
  CONSTRAINT workload_analytics_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.empresas(id),
  CONSTRAINT workload_analytics_persona_id_fkey FOREIGN KEY (persona_id) REFERENCES public.personas(id)
);